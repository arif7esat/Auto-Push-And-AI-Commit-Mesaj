#!/bin/bash

# AutoPush - Ana Kontrol Scripti
# Kullanım: ./autopush [start|stop|status|restart]
# Mevcut dizindeki .git repository ile çalışır

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SCRIPTS_DIR="$SCRIPT_DIR/autopush-scripts"

# Scripts klasörü var mı kontrol et
if [ ! -d "$SCRIPTS_DIR" ]; then
    echo "❌ HATA: autopush-scripts klasörü bulunamadı!"
    exit 1
fi

# Mevcut dizinde .git'i kontrol et
if [ ! -d ".git" ]; then
    echo "❌ HATA: Bu dizinde .git repository bulunamadı!"
    echo "Mevcut dizin: $SCRIPT_DIR"
    exit 1
fi

echo "📁 Git repository dizini: $SCRIPT_DIR"

case "$1" in
    start)
        echo "AutoPush başlatılıyor..."
        "$SCRIPTS_DIR/start_autopush.sh"
        ;;
    stop)
        echo "AutoPush durduruluyor..."
        "$SCRIPTS_DIR/stop_autopush.sh"
        ;;
    status)
        "$SCRIPTS_DIR/status_autopush.sh"
        ;;
    restart)
        echo "AutoPush yeniden başlatılıyor..."
        "$SCRIPTS_DIR/stop_autopush.sh"
        sleep 2
        "$SCRIPTS_DIR/start_autopush.sh"
        ;;
    *)
        echo "AutoPush - Basit Otomatik Git Push Sistemi"
        echo ""
        echo "Kullanım: $0 [start|stop|status|restart]"
        echo ""
        echo "Komutlar:"
        echo "  start   - AutoPush'ı başlat"
        echo "  stop    - AutoPush'ı durdur"
        echo "  status  - Durumu kontrol et"
        echo "  restart - AutoPush'ı yeniden başlat"
        echo ""
        echo "Özellikler:"
        echo "  - 10 dakikada bir otomatik push"
        echo "  - Backup branch'e push yapar"
        echo "  - Arka planda çalışır"
        echo "  - Terminal kapansa bile çalışmaya devam eder"
        echo "  - Log tutar (program_log)"
        echo "  - PID bilgisini saklar (autopush.pid)"
        echo "  - Mevcut dizindeki .git ile çalışır"
        echo ""
        echo "Git Repository: $SCRIPT_DIR"
        ;;
esac
